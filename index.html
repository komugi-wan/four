<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sticky Note Pad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #e5e7eb; overflow: hidden; }
        .page-container { display: flex; transition: transform 0.3s ease-out; height: calc(100vh - 120px); }
        .page { min-width: 100%; height: 100%; padding: 20px; box-sizing: border-box; overflow-y: auto; background-image: radial-gradient(#d1d5db 1px, transparent 1px); background-size: 20px 20px; }
        .sticky-note { width: 140px; min-height: 140px; padding: 10px; margin: 10px; background: #fff9c4; box-shadow: 3px 3px 10px rgba(0,0,0,0.1); border-bottom-right-radius: 20px 5px; transform: rotate(-1deg); display: inline-block; vertical-align: top; }
        .sticky-note:nth-child(even) { transform: rotate(1.5deg); background: #e3f2fd; }
        .active-tab { border-bottom: 4px solid #3b82f6; color: #3b82f6; font-weight: bold; }
    </style>
</head>
<body class="fixed inset-0 flex flex-col">

    <div id="tab-bar" class="flex bg-white shadow-md overflow-x-auto whitespace-nowrap scrollbar-hide">
        </div>
    <div class="flex bg-white px-2 py-1 border-t text-xs justify-between items-center">
        <button onclick="addNotebook()" class="bg-blue-500 text-white px-3 py-1 rounded">+ ノート追加</button>
        <span id="page-indicator" class="text-gray-500 italic">Page 1</span>
        <button onclick="deleteCurrentNotebook()" class="text-red-400">ノート削除</button>
    </div>

    <div id="viewer" class="flex-1 overflow-hidden relative" ontouchstart="handleTouchStart(event)" ontouchmove="handleTouchMove(event)" ontouchend="handleTouchEnd()">
        <div id="page-container" class="page-container">
            </div>
    </div>

    <div class="p-4 bg-white flex justify-around border-t shadow-inner">
        <button onclick="addPage()" class="bg-gray-200 p-2 rounded-lg text-sm">＋ ページ追加</button>
        <button onclick="addSticky()" class="bg-yellow-200 p-2 rounded-lg text-sm font-bold">＋ 付箋を貼る</button>
    </div>

    <script>
        let notebooks = JSON.parse(localStorage.getItem('sticky_notes_data')) || [
            { title: "Note 1", pages: [ { notes: ["最初の付箋です"] } ] }
        ];
        let currentNotebookIdx = 0;
        let currentPageIdx = 0;

        // --- タッチスワイプ制御 ---
        let touchStartX = 0;
        let touchEndX = 0;

        function handleTouchStart(e) { touchStartX = e.changedTouches[0].screenX; }
        function handleTouchMove(e) { touchEndX = e.changedTouches[0].screenX; }
        function handleTouchEnd() {
            const diff = touchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                if (diff > 0) movePage(1); // 左スワイプ -> 次へ
                else movePage(-1);        // 右スワイプ -> 前へ
            }
        }

        function movePage(dir) {
            const pages = notebooks[currentNotebookIdx].pages;
            const newIdx = currentPageIdx + dir;
            if (newIdx >= 0 && newIdx < pages.length) {
                currentPageIdx = newIdx;
                render();
            }
        }

        // --- データ操作 ---
        function addNotebook() {
            const title = prompt("ノートの名前を入力してください", "新ノート");
            if (title) {
                notebooks.push({ title: title, pages: [{ notes: [] }] });
                currentNotebookIdx = notebooks.length - 1;
                currentPageIdx = 0;
                saveAndRender();
            }
        }

        function deleteCurrentNotebook() {
            if (confirm("このノートを丸ごと削除しますか？")) {
                notebooks.splice(currentNotebookIdx, 1);
                if (notebooks.length === 0) notebooks = [{ title: "Note 1", pages: [{ notes: [] }] }];
                currentNotebookIdx = 0;
                currentPageIdx = 0;
                saveAndRender();
            }
        }

        function addPage() {
            notebooks[currentNotebookIdx].pages.push({ notes: [] });
            currentPageIdx = notebooks[currentNotebookIdx].pages.length - 1;
            saveAndRender();
        }

        function addSticky() {
            const text = prompt("メモを入力してください");
            if (text) {
                notebooks[currentNotebookIdx].pages[currentPageIdx].notes.push(text);
                saveAndRender();
            }
        }

        function deleteSticky(idx) {
            notebooks[currentNotebookIdx].pages[currentPageIdx].notes.splice(idx, 1);
            saveAndRender();
        }

        function saveAndRender() {
            localStorage.setItem('sticky_notes_data', JSON.stringify(notebooks));
            render();
        }

        // --- 描画 ---
        function render() {
            // タブの描画
            const tabBar = document.getElementById('tab-bar');
            tabBar.innerHTML = notebooks.map((nb, i) => `
                <div onclick="switchNotebook(${i})" class="px-6 py-3 cursor-pointer ${i === currentNotebookIdx ? 'active-tab' : 'text-gray-400'}">
                    ${nb.title}
                </div>
            `).join('');

            // ページの描画
            const container = document.getElementById('page-container');
            const currentNB = notebooks[currentNotebookIdx];
            
            container.style.width = `${currentNB.pages.length * 100}%`;
            container.style.transform = `translateX(-${(currentPageIdx * (100 / currentNB.pages.length))}%)`;

            container.innerHTML = currentNB.pages.map((page, pIdx) => `
                <div class="page">
                    ${page.notes.map((note, nIdx) => `
                        <div class="sticky-note" onclick="deleteSticky(${nIdx})">
                            <p class="text-sm text-gray-800 break-words">${note}</p>
                        </div>
                    `).join('')}
                    ${page.notes.length === 0 ? '<p class="text-gray-300 text-center mt-20">ページは空です</p>' : ''}
                </div>
            `).join('');

            document.getElementById('page-indicator').innerText = `${currentPageIdx + 1} / ${currentNB.pages.length} ページ`;
        }

        function switchNotebook(idx) {
            currentNotebookIdx = idx;
            currentPageIdx = 0;
            render();
        }

        render();
    </script>
</body>
</html>
